"use strict";StackExchange.tagEditor=function(e,t,n,i){function r(){U=!0}function o(){if("undefined"==typeof bt){for(var e=StackExchange.tagEditor.requiredTags,t=[],n=0;n<e.length;n++)t.push(f(e[n]).replace(/[.+]/g,"\\$&"));bt=new RegExp("^(?:"+t.join("|")+")$")}return bt}function a(){if(!i.ignoreRequired){var e=StackExchange.tagEditor.requiredTags;if(e&&/^ ?$/.test(ft.val())){var t=o();0===dt.add(pt).children().filter(function(){return t.test($(this).text())}).length&&A(StackExchange.tagEditor.requiredTags)}}}function s(e,t){var n=H(e);if(i.tagMenus&&n.data("tag-menu-tagname",e),!t){if(n.hasClass("s-tag")){var r="<svg style='pointer-events:none;' class='svg-icon iconClearSm' width='12' height='12' viewBox='0 0 14 14'><path d='M12 3.41L10.59 2 7 5.59 3.41 2 2 3.41 5.59 7 2 10.59 3.41 12 7 8.41 10.59 12 12 10.59 8.41 7z'></path></svg>",o=$("<a>",{"class":"js-delete-tag s-tag--dismiss","title":i.tooltipDeleteTag||"Remove tag"});o.append($(r)),n.append(o)}else n.append($("<span>",{"class":"js-delete-tag delete-tag","title":i.tooltipDeleteTag||"Remove tag"}));X.trigger("tagSpanCreated",[n])}return i.tagSpanCreated&&i.tagSpanCreated(n),n}function c(e){var t=$([]),n=$([]);switch(e){case Ct.all:t=dt.find(".rendered-element"),n=pt.find(".rendered-element");break;case Ct.left:t=dt.find(".rendered-element:last");break;case Ct.right:n=pt.find(".rendered-element:first");break;case Ct.all_left:t=dt.find(".rendered-element");break;case Ct.all_right:n=pt.find(".rendered-element")}return{"pre":t,"post":n}}function l(e){e=e||Ct.all;var t=c(e),n=t.pre.map(function(e,t){return $(t).text()}).get(),i=n.join(" ");i.length&&(i+=" ");var r=t.post.map(function(e,t){return $(t).text()}).get(),o=r.join(" ");o.length&&ft.val().length&&(o=" "+o);var a=ft.val();return n=n.concat(r),{"text":i+ft.val()+o,"lengthBeforeInput":i.length,"val":a,"tags":n}}function u(t){t=t||l(),setTimeout(function(){e.trigger("tageditor:renderedchange",[t.tags,t.val])}),y()}function d(){var e=ft.val();return(""===e||" "===e)&&0===dt.add(pt).children().filter(function(){return!/^\s*$/.test($(this).text())}).length}function f(e){return i.getTagNameFromData?i.getTagNameFromData(e):e.Name}function p(e){e=e||Ct.all;var t=ft.caret(),n=ft[0].selectionDirection,i=c(e);if(i.pre.add(i.post).length){var r=l(e);ft.val(r.text),i.pre.remove(),i.post.remove(),ft.caret(t.start+r.lengthBeforeInput,t.end+r.lengthBeforeInput),st&&(ft[0].selectionDirection=n),L(),u()}}function h(e){if(i.operators&&i.operators.test(e))return $("<span class='rendered-element'/>").text(e);var t=s(e).addClass("rendered-element");return g(e)||t.addClass("invalid-tag temp-tag__danger").attr("title",i.tooltipInvalidTag||"invalid tag"),t}function g(e){return i.invalid&&i.invalid[e]?!1:i.isTagValid&&!i.isTagValid(e)?!1:!0}function m(t){if(!yt){var n;if(n=t?{"start":ft.val().length,"end":ft.val().length}:ft.caret(),-1==n.start&&(n.start=n.end=0),!st&&n.start!==n.end)return p(),y(),void 0;var r=ft.val(),o=r.substr(0,n.start),s=r.substr(n.end),c=ft[0].selectionDirection,f=i.customCleanUpSplitRegex||/[,;\s]+/,g=(o+"!").split(f);g[g.length-1]="!"===g[g.length-1]?"":g[g.length-1].slice(0,-1);var m=s.split(f),v=g.pop(),b=v.length;v+=r.substring(n.start,n.end),v+=m.shift(),g=Q(g.join(" ")),m=Q(m.join(" "));var w,x=!!g.length||!!m.length;for(w=0;w<g.length;w++)h(g[w]).appendTo(dt);for(w=0;w<m.length;w++)h(m[w]).appendTo(pt);v!==ft.val()&&ft.val(v);var k=X.find(".rendered-element"),S=K(k.map(function(e,t){return $(t).text()}),dt.find(".rendered-element").length);w=0,k.filter(function(){return!S[w++]}).remove();var E=l(),C=$.trim(E.text);C!=e.val()&&(e.val(C).trigger("change"),StackExchange.MarkdownEditor&&!i.ignoreStyleCode&&styleCode.updateLangdivDelayed.trigger(C.split(/ /g))),x&&u(E),U&&(ft.caret(b,b+n.end-n.start),st&&(ft[0].selectionDirection=c),T(),a()),y(),d()?ft.attr("placeholder")!==W&&ft.attr("placeholder",W):""!==ft.attr("placeholder")&&ft.attr("placeholder","")}}function v(e,t,n,i){var r,o;if("string"==typeof e)o=e;else{if(!e.length)return;r=e,o=r.text()}for(var a=Q(ft.val()),s=0;s<a.length;s++)h(a[s]).appendTo(dt);if(ft.val(o),r){var c=$($.unique(r.prevAll(".rendered-element").get()));r.nextAll(".rendered-element").prependTo(pt),c.appendTo(dt),r.remove()}else pt.find(".rendered-element").appendTo(dt);(U||!n)&&ft.focus(),t&&ft.caret(0,0),i||u()}function b(e){var t=e.val(),n="c_"+t;if(n in Tt)return Tt[n];var i=$("<span />").css({"font-family":e.css("font-family"),"font-size":e.css("font-size"),"display":"inline-block"});i.text(e.val()),i.insertAfter(e);var r=i.innerWidth();return i.remove(),Tt[n]=r,r}function y(){at&&(Z=X.innerWidth());{var e=b(ft)+19;dt.outerWidth()}ft.css("width",e);var t=ft.position().top,n=t;return n>0&&ut>n+lt?void 0:t+X.scrollTop()+lt<ut?(X.scrollTop(0),void 0):(X.scrollTop(t-(ut-lt)/2+X.scrollTop()),void 0)}function w(e,t){var n;n=e>0?pt.find("> *"):dt.find("> *");for(var i,r,o=ft.position(),a=ft.val().length,s=a>0?ft.caret().start/a:.5,c=o.left+ft.width()*s,l=0;l<n.length;l++){var u=n.eq(e>0?l:n.length-l-1),d=u.position();if("undefined"!=typeof r){if(d.top!==r)break}else{var f=Math.abs(d.top-o.top);if(!(f>lt/2))continue;r=d.top}var h=d.left+u.width()/2;if(0>e&&c>h||e>0&&h>c){i=i||u;break}i=u}if(i){if(t){for(;i.parent().length;)p(e>0?Ct.right:Ct.left);ft.caret(0,ft.val().length)}else v(i);return!0}return!1}function x(){St=!0,setTimeout(function(){St=!1},0)}function k(){var e=Q(ft.val())[0];if(e){var t=$("<span data-tag-name='"+e+"'/>");M(t)}}function S(e){if(!st&&e.shiftKey&&_t[e.which]||e.ctrlKey&&65===e.which)return p(),!0;var t,n,r=ft.caret(),o=ft[0].selectionDirection,a="forward"===o?r.end:r.start,s=a===ft.val().length,c=0===a;switch(e.which){case 37:return c?(t=dt.find(".rendered-element:last"),t.length?(e.shiftKey?p(Ct.left):v(t),e.shiftKey):!0):!0;case 39:return s?(n=pt.find(".rendered-element:first"),n.length?(e.shiftKey?p(Ct.right):v(n,!0),e.shiftKey):!0):!0;case 8:return c?(t=dt.find(".rendered-element:last"),t.length?(ft.val(t.text()+ft.val()),ft.caret(t.text().length,t.text().length),t.remove(),u(),!1):!0):!0;case 46:return s?(n=pt.find(".rendered-element:first"),n.length?(ft.val(ft.val()+n.text()),ft.caret(a,a),n.remove(),u(),!1):!0):!0;case 38:if(w(-1,e.shiftKey))return!1;case 36:return t=dt.find(".rendered-element:first"),t.length?(e.shiftKey?p(Ct.all_left):v(t,!0),e.shiftKey):!0;case 40:var l=J.children("div:first");if(l.length)return x(),l.focus(),!1;if(w(1,e.shiftKey))return!1;case 35:return n=pt.find(".rendered-element:last"),n.length?(e.shiftKey?p(Ct.all_right):v(n),e.shiftKey):!0;case 9:x(),i.renderErrorTagIfNoResults&&!C()&&k();break;case 13:if(C())return!1;break;case 32:if(i.spaceSelectsTopSuggestion===!1)return!1;if(i.spaceSelectsTopSuggestion&&C())return M(J.children("div:first")),!1}return!0}function E(e){return 27===e.which&&J.length>0?(L(),e.preventDefault(!0),e.stopPropagation(),!1):!0}function C(){return!!J.length&&!J.hasClass("no-results")}function T(){var e=Y(ft.val());return e&&(i.searchTermModifier&&(e=i.searchTermModifier(e)),i.allowUpperCaseTagNames&&(e=e.toLocaleLowerCase())),$t!==e?($t=e,e&&e.length?(_(e,function(t){e===$t&&U&&A(t,e)}),void 0):(wt()||L(),void 0)):void 0}function _(e,t){var n=O(e);jt[n]?t(jt[n]):Ot.trigger(e,t)}function j(){return i.tagApiUrl||"/filter/tags"}function O(e){return j()+"|"+e}function A(e,t){J.remove(),yt=!1;for(var n=X.height(),r=G(X.find(".rendered-element").map(function(e,t){return $(t).text()}).get(),dt.find(".rendered-element").length),o=e.length-1;o>=0;o--)-1!==r.indexOf(f(e[o]))&&e.splice(o,1);var a=e.length;if(0===a)return J=$("<div class='tag-suggestions no-results box-border fs-cation fc-light c-default'>No results found</div>").css({"position":"absolute","left":X.position().left,"top":X.position().top+n+1,"width":tt}).insertAfter(X),void 0;J=$("<div class='tag-suggestions js-tag-suggestions box-border' />").css({"position":"absolute","left":X.position().left,"top":X.position().top+n+1,"width":tt}).insertAfter(X);for(var s=i.suggestionTagBoxRenderer||P,o=0;o<e.length;o++){var c=s(e[o],t).appendTo(J).attr("tabindex",ht||0);I(c),o%F!==0||it||c.css("clear","both")}J.on({"keydown":D,"keyup":N,"click":function(e){$(e.target).is("a")||M($(this))},"focus":function(){St&&1===a?M($(this)):yt=!0},"blur":function(){yt=!1}},"div")}function P(e,t){var n=f(e),r=$("<div />").css("width",it?"auto":nt).data("tag-name",(e.Negated?"not ":"")+(e.SynonymOf||n));t&&(t=t.replace(/-/g,"").replace(/\*+/g,"	").replace(/([^\t])(?=[^\t])/g,"$1-*").replace(/\+/g,"\\+").replace(/\./g,"\\.").replace(/\t/g,".*"));var o=i.operators&&i.operators.test(n),a=o?$('<span class="px4 fs-caption">').text(n):s(n,!0),c=a.html();if(t&&(c=c.replace(new RegExp("("+t+")"),"<span class='match'>$1</span>")),it&&a.addClass("m0"),e.Negated&&r.append($('<span class="pr6 fs-caption">').text("not")),r.append(a.html(c)),!e.Count||it||o||r.append($("<span class='item-multiplier' />").html("&times;&nbsp;"+e.Count)),z&&!it&&!o){var l="";if(e.Excerpt&&(l=e.Excerpt),l.length&&r.append($("<p />").text(l)),e.Synonyms&&e.Synonyms.length)for(var u=$("<p >also:</p>").appendTo(r),d=e.Synonyms.split(/\|/),p=0;p<d.length;p++)l=d[p],t&&(l=l.replace(new RegExp("("+t+")"),"<span class='match'>$1</span>")),p>0&&(l=", "+l),u.append("<span>"+l+"</span>")}if(V&&!it&&!o){var h=e.InfoUrl;h||(h=(e.IsDiverged?StackExchange.options.site.routePrefix:"")+"/tags/"+encodeURIComponent(e.SynonymOf||n)+"/info"),r.append("<p class='more-info'><a href='"+h+"' target='_blank'>learn more</a></p>")}return r}function I(e){var t=e.find("p.more-info");"undefined"==typeof Et&&(Et=nt-5-t.outerWidth());var n=e.find(".rendered-element:first").outerWidth()+e.find(".item-multiplier").outerWidth();n>Et&&t.find("a").text("info")}function M(e){ft.val(e.data("tag-name")),L(),v(""),m()}function R(e){StackExchange.options.enableLogging&&(console.log("tag editor new: "+e),"string"!=typeof e&&console.log(e))}function L(){J.remove(),J=$(),yt=!1,Ot.cancel()}function D(e){var t;switch(e.which){case 39:case 40:return $(this).next("div").focus(),!1;case 37:return $(this).prev("div").focus(),!1;case 38:return t=$(this).prev("div"),t.length?t.focus():ft.focus(),!1;case 13:return M($(this)),!1;case 32:return i.spaceSelectsTopSuggestion&&M($(this)),!1}}function N(e){return 27===e.which?(L(),ft.focus(),e.stopPropagation(),!1):!0}var U;if("undefined"==typeof n)try{U=e.is(":focus")}catch(B){U=!1}else U=n;if(e.bind("focus",r),!e.is(":visible")){t=t||0;var q=$("body").is(":visible");return 3>t?(setTimeout(function(){e.unbind("focus",r),StackExchange.tagEditor(e,t+(q?1:0),U,i)},300),void 0):(e.unbind("focus",r),$("body.review-task-page").length||StackExchange.debug.log("tag box is invisible, couldn't start tag editor"),void 0)}i||(i={});var F=i.columns||3,z="undefined"==typeof i.excerpts||i.excerpts,V="undefined"==typeof i.learnMore||i.learnMore,W=e.attr("placeholder")||"",H=i.renderTag||function(e){return window.tagRenderer(e,null,"span",i.useStacksClasses)},K=i.customFilterTags||function(e){var t={};return e.map(function(e){return/^\s*$/.test(e)?!1:t[e]===!0?!1:(i.operators&&i.operators.test(e)||(t[e]=!0),!0)})},G=i.customExistingTags||function(e){return e},Q=i.customSafeTags||function(e){var t=StackExchange.helpers.sanitizeAndSplitTags(e,!1,!!i.operators,i.allowUpperCaseTagNames)||[];return e&&$.trim(e)&&R('safeTags("{0}") => {1}'.formatUnicorn(e,t.toString())),t},Y=i.sanitizeSearchTerm||function(e){return Q(e)[0]},J=$();e.unbind("focus",r);var Z=e.innerWidth(),X=$("<div class='js-tag-editor tag-editor multi-line' />").insertAfter(e);X.data("target-field",e.get(0)),i.extraTagEditorCssClass&&X.addClass(i.extraTagEditorCssClass),["padding-right","padding-left","box-sizing","margin-top","margin-bottom"].forEach(function(t){X.css(t,e.css(t))});var et="border-box"===e.css("box-sizing");et&&(Z+=parseInt(X.css("border-right-width"),10)+parseInt(X.css("border-left-width"),10));var tt=i.suggestionsWidth||Z,nt=(tt-12)/F|0,it=i.responsiveIsh&&150>nt;X.css("width",Z);var rt=e.css("display");e.hide();var ot=getComputedStyle(e[0]).width,at=/%$/.test(ot);at&&X.css("width",ot),"inline"===rt&&X.css("display","inline-block");var st="selectionDirection"in e[0],ct=H("test").appendTo(X),lt=et?X.outerHeight():X.innerHeight(),ut=e.innerHeight();ct.remove(),et&&(ut+=parseInt(X.css("border-top-width"),10)+parseInt(X.css("border-bottom-width"),10));var dt=$("<span />").appendTo(X),ft=$("<input type='text' autocomplete='off' tabIndex='0'/>").appendTo(X).val(e.val()+" ").attr("placeholder",W),pt=$("<span />").appendTo(X),ht=e.attr("tabIndex"),gt=e.attr("id");if(gt){var mt=$("label[for='"+gt+"']");if(mt.length){var vt="tageditor-replacing-"+gt+"--input";ft.attr("id",vt),mt.attr("for",vt)}}ht&&ft.attr("tabIndex",ht),e.hasClass("s-input")&&(X.addClass("s-input").css({"paddingTop":0,"paddingBottom":0}),ft.addClass("s-input")),ft.addClass("js-tageditor-replacing");var bt,yt=!1,wt=function(){return i.showAllWhenEmptyAndFocused&&i.getDataPromise&&d()?(i.getDataPromise("").done(function(e){A(e.slice(0,StackExchange.settings.mentions.maxNumUsersInDropdown))}),!0):!1},xt=U;ft.focus(function(t,n){U=!0,a(),xt||(n||e.triggerHandler("focus",!0),xt=!0),wt()});var kt=!1;X.mousedown(function(){kt=!0,$(document).one("mouseup",function(){setTimeout(function(){U||(e.triggerHandler("blur"),xt=!1),kt=!1},0)})}),ft.blur(function(){U=!1,setTimeout(function(){yt||(L(),m(),kt||(e.triggerHandler("blur"),xt=!1)),kt=!1},0)}),e.focus(function(e,t){t||ft.trigger("focus",!0)}),ft.on({"keydown":S,"keyup":E,"input":function(){setTimeout(m,0)}}),X.delegate(".rendered-element","click",function(e){var t=$(this);$(e.target).hasClass("js-delete-tag")&&t.text(""),v(t),m()}),X.click(function(e){e.target===this&&(v(""),m())}),X.on("rerender",function(){p(),m(!0)});var St,$t,Et,Ct={"left":1,"right":2,"all_left":3,"all_right":4,"all":5},Tt={},_t={"35":!0,"36":!0,"37":!0,"38":!0,"39":!0,"40":!0},jt={},Ot=StackExchange.helpers.DelayedReaction(function(e,t){StackExchange.helpers.addSpinner(X,{"position":"absolute","right":10,"top":ut/2-2});var n=null;if(i.getDataPromise)n=i.getDataPromise(e);else{var r=j(),o={"q":e,"newstyle":!0};i.alterQueryParametersBeforeSend&&i.alterQueryParametersBeforeSend(o),n=$.get(r,o,"json")}n.done(function(n){jt[O(e)]=n,StackExchange.helpers.removeSpinner(),t(n)})},400,{"sliding":!0});m(!0),StackExchange.tagEditor.ready.resolve(),e[0].func_clear=function(){e.val(""),ft.val("").blur(),X.find(".rendered-element").remove()},e[0].func_add=function(e){var t=ft.val();ft.val(e),v(t,!1,!0),m()},e[0].func_finish=function(){v("")},e[0].func_redraw=function(){var t=e.val();e.val(""),ft.val("").blur(),X.find(".rendered-element").remove(),ft.val(t),v("",!1,!0,!0),m()}},StackExchange.tagEditor.ready=$.Deferred();